<div class="bookings-page">
    <h1>Bookings</h1>

    <nav>
      <div class="datepicker-wrap">
        Select Month:<br clear="both">
        <uib-datepicker ng-model="disp.month"
            datepicker-options="{minMode: 'month'}"></uib-datepicker>
      </div>

      <div class="datepicker-wrap">
      Select Start Date:<br clear="both">
      <uib-datepicker ng-model="filter.startDate"
          datepicker-options="{minMode: 'day'}"></uib-datepicker>
      </div>

      <div class="datepicker-wrap">
      Select End Date:<br clear="both">
      <uib-datepicker ng-model="filter.endDate"
          datepicker-options="{minMode: 'day'}"></uib-datepicker>
      </div>

      <br clear="both" />

      <div>
        <label>
          Route:
          <select ng-options="route.id as (route.label + ': ' + route.name) for route in disp.availableRoutes"
            ng-model="filter.routeId"
            ng-required="false">
            <option value="">(All)</option>
          </select>
        </label>
      </div>

      <div>
        Status:
        <label>
          <input type="checkbox"
            ng-model="filter.status.valid"
            />
            Valid
        </label>

        <label>
          <input type="checkbox"
            ng-model="filter.status.refunded"
            />
            Refunded
        </label>

        <label>
          <input type="checkbox"
            ng-model="filter.status.failed"
            />
            Failed
        </label>
      </div>

      <div>
        Sort
        <label>
          <input type="radio"
          ng-model="filter.filterBy"
          value="transaction.createdAt"
          />
          Transaction date
        </label>

        <label>
          <input type="radio"
          ng-model="filter.filterBy"
          value="boardStop.time"
          />
          Trip time
        </label>
      </div>

      <div>
        Order
        <label>
          <input type="radio"
          ng-model="filter.order"
          value="desc"
          />
          Descending
        </label>
        <label>
          <input type="radio"
          ng-model="filter.order"
          value="asc"
          />
          Ascending
        </label>
      </div>

      <a href="{{ csvUrl }}">
        Download CSV
      </a>
    </nav>


    <uib-pagination
      boundary-links="true"
      ng-model="currentPage"
      total-items="pageCount * perPage"
      items-per-page="perPage"
    ></uib-pagination>

    <table class="table table-striped transactions-view">
      <thead>
        <tr>
          <th>Booking Id</th>
          <th>Charge Id</th>
          <th>Timestamp</th>
          <th>User name</th>
          <th>Passenger No.</th>
          <th>User phone </th>
          <th>User email</th>
          <th>Ticket id</th>
          <th>Trip id</th>
          <th>Trip date</th>
          <th>Route Id</th>
          <th>Route Label</th>
          <th>Route description</th>
          <th>Pick-up stop</th>
          <th>Drop-off stop</th>
          <th>Price per trip</th>
          <th>Status</th>
          <th>Refund</th>
        </tr>
      </thead>

      <tbody>
        <tr ng-repeat="ticket in tickets"
            ng-class="{
              valid: ticket.status == 'valid',
              refunded: ticket.status == 'refunded',
              failed: ticket.status == 'failed',
            }"
        >
          <td>
            {{ticket.transactionId}}
          </td>
          <td>
            {{ticket.paymentResource}}
          </td>
          <td>
            {{ticket.transaction.createdAt | date:'dd MMM yy HH:mm:ss'}}
          </td>
          <td>
            {{ticket.user.json.name || ticket.user.name}}
          </td>
          <td>
            {{ticket.user.json.index == undefined ? '' : ticket.user.json.index + 1}}
          </td>
          <td>
            {{ticket.user.json.telephone || ticket.user.telephone}}
          </td>
          <td>
            {{ticket.user.json.email || ticket.user.email}}
          </td>
          <td>
            {{ticket.id}}
          </td>
          <td>
            {{ticket.trip.id}}
          </td>
          <td>
            {{ticket.trip.date | date:'dd MMM yy':'UTC'}}
          </td>
          <td>
            {{ticket.trip.routeId}}
          </td>
          <td>
            {{ticket.route.label}}
          </td>
          <td>
            {{ticket.route.from}} &mdash; {{ticket.route.to}}
          </td>
          <td>
            {{ticket.boardStop.time | date:'HH:mm'}},
            {{ticket.boardStop.stop.description}}
          </td>
          <td>
            {{ticket.alightStop.time | date:'HH:mm'}},
            {{ticket.alightStop.stop.description}}
          </td>
          <td>
            {{ticket.trip.price}}
          </td>
          <td>
            {{ticket.status}}
          </td>
          <td>
            <button class="btn btn-danger">
              Refund!
            </button>
          </td>
        </tr>
      </tbody>

    </table>
</div>
